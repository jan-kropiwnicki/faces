{% extends 'base.html' %}

{% block title %}{% if viewed_user == user %}My{% else %}{{ viewed_user.first_name }}'s{% endif %} profile &ndash; {% endblock %}

{% block content %}
    {% if user.is_authenticated %}

        <h2>{{ viewed_user.first_name }} {{ viewed_user.last_name }} @{{ viewed_user.username }}</h2>
        {% if viewed_user == user %}
            <a class="friend-button friend-button-active">You</a>
        {% elif user.person in viewed_user.person.friends.all %}
            <a class="friend-button friend-button-active" href="{% url 'end_friendship' viewed_user.username %}">End friendship</a>
        {% elif user.person in viewed_user.requestprofile.friend_requests.all %}
            <a class="friend-button friend-button-active">Pending friend request</a>
        {% else %}
            <a class="friend-button" href="{% url 'send_request' viewed_user.username %}">Send friend request</a>
        {% endif %}
        {% if post_list %}
            <p>{% if viewed_user == user %}Your{% else %}{{ viewed_user.first_name }}'s{% endif %} posts:</p>
        {% else %}
            <p>This user has no posts.</p>
        {% endif %}
        {% for post in post_list %}
            <div id="{{ post.0.id }}">
                <hr>
                <p>
                    Published on {{ post.0.date.date }} by <a href="{% url 'user' user.username %}">
                    {{ viewed_user.first_name }} {{ viewed_user.last_name }}</a> @{{ viewed_user.username }}
                    {% if viewed_user == user %}&nbsp;<a href="{% url 'edit_post' post.0.id %}" class="post-icon">&#xe800;</a>&nbsp;
                        <a href="{% url 'delete_post' post.0.id %}" class="post-icon">&#xe801;</a>{% endif %}
                </p>
                <p>
                {% for line in post.1 %}
                    {{ line }}<br>
                {% endfor %}
                </p>
                <p>
                    {% if user.likeprofile in post.0.likeprofile_set.all %}
                        <a class="like-icon" id="like-{{ post.0.id }}" onclick="dislike({{ post.0.id }})">&#xf164;</a>
                    {% else %}
                        <a class="like-icon" id="like-{{ post.0.id }}" onclick="like({{ post.0.id }})">&#xe802;</a>
                    {% endif %}
                    <span id="like-count-{{ post.0.id }}">{{ post.2 }}</span>
                </p>
                <script>
                    function like(id) {
                        $.ajax({
                            data: `id=${id}`,
                            url: "{% url 'like' %}",
                            success: function (response) {
                                $("#like-" + id).html("&#xf164;");
                            },
                            error: function (response) {
                                console.log(response.responseJSON.errors)
                            }
                        });
                    }
                    function dislike(id) {
                        $.ajax({
                            data: `id=${id}`,
                            url: "{% url 'dislike' %}",
                            success: function (response) {
                                $("#like-" + id).html("&#xe802;");
                            },
                            error: function (response) {
                                console.log(response.responseJSON.errors)
                            }
                        });
                    }
                </script>
            </div>
        {% endfor %}
    {% endif %}
{% endblock %}